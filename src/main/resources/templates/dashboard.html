<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Dashboard - Sciverse Summit</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        /* Styles for the Layout Structure */
        :root {
            --sidebar-width: 250px;
        }
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            width: var(--sidebar-width); 
            padding-top: 56px; 
            background-color: #f8f9fa;
            z-index: 1000; 
            transition: all 0.3s;
        }
        .content {
            margin-left: var(--sidebar-width); 
            padding: 80px 20px 20px 20px; 
            position: relative; 
            z-index: 1;
            transition: all 0.3s;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        /* Style for when the sidebar is collapsed */
        #sidebarMenu.collapsing, #sidebarMenu.collapse:not(.show) {
            margin-left: calc(-1 * var(--sidebar-width));
        }
        
        .welcome-text {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 40px;
            text-align: center;
        }
        .action-btn {
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: 600;
            border-radius: 8px;
            min-width: 200px;
        }
        .btn-history {
            background-color: #4b5563;
            color: white;
            border: none;
        }
        .btn-history:hover {
            background-color: #374151;
            color: white;
        }
        .btn-create {
            background-color: #4f46e5;
            color: white;
            border: none;
        }
        .btn-create:hover {
            background-color: #4338ca;
            color: white;
        }
    </style>
</head>
<body>

    <!-- 1. HEADER (NAVBAR) FRAGMENT -->
    <div th:replace="fragments :: header"></div>

    <!-- 2. SIDEBAR FRAGMENT (REMOVED for Dashboard) -->
    <!-- <div th:replace="fragments :: sidebar"></div> -->

    <!-- 3. MAIN CONTENT AREA -->
    <div class="content" style="margin-left: 0;">
        
        <h1 class="welcome-text">Welcome! What would you like to do today?</h1>
        
        <div class="d-flex gap-4 align-items-start">
            <a href="/history" class="btn action-btn btn-history text-decoration-none d-flex align-items-center justify-content-center">History</a>
            <button class="btn action-btn btn-create" data-bs-toggle="modal" data-bs-target="#createSessionModal">Create Session</button>
            
            <!-- Active Session Button -->
            <div th:if="${activeSession != null}" class="text-center">
                <button class="btn action-btn btn-primary" data-bs-toggle="modal" data-bs-target="#continueSessionModal" th:text="${activeSession.name}">
                    Session Name
                </button>
                <div class="mt-2 text-muted small">Continue Session</div>
            </div>
        </div>

    </div>

    <!-- Continue Session Modal -->
    <div class="modal fade" id="continueSessionModal" tabindex="-1" aria-hidden="true" th:if="${activeSession != null}">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title fw-bold">Manage Session</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center py-4">
                    <h4 class="mb-4" th:text="${activeSession.name}">Session Name</h4>
                    <p class="text-muted mb-4">What would you like to do with this session?</p>
                    
                    <div class="d-grid gap-3 col-8 mx-auto">
                        <a href="/" class="btn btn-primary btn-lg">Continue Session</a>
                        
                        <form th:action="@{/session/end}" method="post">
                            <input type="hidden" name="sessionId" th:value="${activeSession.id}" />
                            <button type="submit" class="btn btn-outline-danger w-100">End Session</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Session Modal -->
    <div class="modal fade" id="createSessionModal" tabindex="-1" aria-labelledby="createSessionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title fw-bold" id="createSessionModalLabel">Create New Session</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form th:action="@{/session/create}" th:object="${newSession}" method="post">
                        <div class="mb-3">
                            <label for="sessionName" class="form-label fw-semibold">Name of the Session</label>
                            <input type="text" class="form-control" id="sessionName" th:field="*{name}" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="committee" class="form-label fw-semibold">Committee</label>
                            <select class="form-select" id="committee" th:field="*{committee}" required>
                                <option value="Physics">Physics</option>
                                <option value="Chemistry">Chemistry</option>
                                <option value="Biology">Biology</option>
                                <option value="Mathematics">Mathematics</option>
                                <option value="Computer Science">Computer Science</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="strength" class="form-label fw-semibold">Strength (Number of Participants)</label>
                            <input type="number" class="form-control" id="strength" th:field="*{strength}" min="1" required>
                        </div>
                        
                        <div class="mb-4">
                            <label for="topic" class="form-label fw-semibold">Topic of the session</label>
                            <input type="text" class="form-control" id="topic" th:field="*{topic}" required>
                        </div>
                        
                        <button type="submit" class="btn btn-success w-100 py-2 fw-bold">Create</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
