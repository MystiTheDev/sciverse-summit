<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Motion Setup</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        /* Define sidebar width and transition for content alignment */
        :root { --sidebar-width: 250px; }
        .sidebar {
            position: fixed; top: 0; left: 0; height: 100%; width: var(--sidebar-width); 
            padding-top: 56px; background-color: #f8f9fa; z-index: 1000; transition: all 0.3s;
        }
        .content {
            margin-left: var(--sidebar-width); padding: 80px 20px 20px 20px; 
            position: relative; z-index: 1; transition: all 0.3s;
        }
        @media (max-width: 991.98px) {
            .sidebar { width: 0; }
            .content { margin-left: 0; }
        }
        
        /* Ensure the input group has appropriate height for the search icon */
        .input-group .form-control-lg {
            height: calc(3.5rem + 2px); /* Match height of button */
        }
        .input-group .btn-lg {
            min-width: 50px;
        }
        
        /* Custom styling for the red/error-like input group for Proposer */
        .proposer-input .form-control {
            border-color: #dc3545; /* Red border */
            box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.25); /* Light red shadow */
        }
        
        /* Plus button style matching the screenshot */
        .plus-button-container {
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #e0f7fa; /* Light cyan/blue background */
            border: 1px solid #00bcd4;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .plus-button-container:hover {
            background-color: #b2ebf2;
        }
        .plus-button-container i {
            font-size: 1.5rem;
            color: #00bcd4;
        }
        
        /* Switch/Toggle styling */
        .form-check-label {
            cursor: pointer;
        }
        
        /* Footer text styling */
        .motion-footer {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            font-size: 0.9rem;
            color: #6c757d;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }
        .clear-link {
            text-decoration: none;
            color: #dc3545;
            font-weight: 500;
        }
    </style>
</head>
<body>

    <!-- 1. HEADER (NAVBAR) FRAGMENT: Assumed to be included via Thymeleaf -->
    <div th:replace="fragments :: header"></div>

    <!-- 2. SIDEBAR FRAGMENT: Assumed to be included via Thymeleaf -->
    <div th:replace="fragments :: sidebar"></div>

    <!-- 3. MAIN CONTENT AREA -->
    <div class="content">
        <div class="container-fluid">

            <div class="row justify-content-center">
                <div class="col-lg-6 col-md-8">
                    <h2 class="mb-4">Set caucus details</h2>

                    <!-- MOTION TYPE DROPDOWN -->
                    <div class="mb-3">
                        <label for="motion-type-select" class="form-label fw-bold">Type</label>
                        <div class="input-group">
                            <!-- Populated by JS -->
                            <select id="motion-type-select" class="form-select form-select-lg" aria-label="Motion Type">
                                <option value="" selected disabled>Select a motion type</option>
                            </select>
                            <button class="btn btn-outline-secondary btn-lg" type="button" title="Search options">
                                <i class="bi bi-search"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- PROPOSER INPUT -->
                    <div class="mb-3">
                        <label for="proposer-input" class="form-label fw-bold">Proposer</label>
                        <div class="input-group proposer-input">
                            <input type="text" id="proposer-input" class="form-control form-control-lg" placeholder="Start typing delegate name..." aria-label="Proposer Name" required list="delegate-list">
                            <datalist id="delegate-list">
                                <option th:each="delegate : ${delegateList}" th:value="${delegate}"></option>
                            </datalist>
                            <button class="btn btn-outline-secondary btn-lg" type="button" title="Search delegates">
                                <i class="bi bi-search"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- DURATION INPUT -->
                    <div class="mb-3">
                        <label for="duration-input" class="form-label fw-bold">Duration</label>
                        <div class="row g-2">
                            <div class="col-6">
                                <input type="number" id="duration-input" class="form-control form-control-lg" value="10" min="1">
                            </div>
                            <div class="col-6">
                                <select id="duration-unit-select" class="form-select form-select-lg">
                                    <option value="min" selected>min</option>
                                    <option value="sec">sec</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- ADD BUTTON (Stylized Plus) -->
                    <div class="plus-button-container" id="add-motion-button">
                        <i class="bi bi-plus"></i>
                    </div>

                    <!-- TOGGLES -->
                    <div class="d-flex justify-content-between mt-4">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" role="switch" id="can-propose" checked>
                            <label class="form-check-label" for="can-propose">Delegates can propose motions</label>
                        </div>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" role="switch" id="can-vote" checked>
                            <label class="form-check-label" for="can-vote">Delegates can vote on motions</label>
                        </div>
                    </div>
                    
                    <!-- FOOTER TEXT -->
                    <div class="motion-footer">
                        <div>
                            <span class="me-2"><i class="bi bi-arrow-down-up"></i></span>
                            <span>Sorted from most to least disruptive. 14 votes required to pass a motion</span>
                        </div>
                        <a href="#" class="clear-link" onclick="handleClear(event)">Clear</a>
                    </div>
                    
                    <!-- Container for Added Motions -->
                    <div id="motions-container" class="mt-4">
                        <!-- Cards will be appended here -->
                    </div>

                </div>
            </div>
        </div>
    </div>
    
    <!-- JavaScript for Functionality -->
    <script>
        // List of motions as per the image
        const parliamentaryMotions = [
            "Open unmoderated caucus",
            "Open moderated caucus",
            "Extend unmoderated caucus",
            "Extend moderated caucus",
            "Close moderated caucus",
            "Introduce draft resolution",
            "Introduce amendment",
            "Vote on resolution",
            "Vote on amendment",
            "Roll Call",
            "Point of Parliamentary Procedure",
            "Point of Personal Privilege",
            "Point of Inquiry",
            "Point of Information",
            "Suspend Meeting",
            "Adjourn Meeting",
            "Set Speakers Time"
        ];

        function populateMotionTypeDropdown() {
            const select = document.getElementById('motion-type-select');
            
            // Clear existing options except the first placeholder
            while (select.options.length > 1) {
                select.remove(1);
            }

            parliamentaryMotions.forEach(motion => {
                const option = document.createElement('option');
                option.value = motion;
                option.textContent = motion;
                select.appendChild(option);
            });
            
            // Set the default selected option based on the screenshot
            select.value = "Open unmoderated caucus"; 
        }

        function handleClear(event) {
            event.preventDefault(); // Prevent link default action
            
            // Clear Proposer
            document.getElementById('proposer-input').value = '';
            
            // Reset Duration
            document.getElementById('duration-input').value = 10;
            document.getElementById('duration-unit-select').value = 'min';

            // Reset Toggles (assuming default is checked)
            document.getElementById('can-propose').checked = true;
            document.getElementById('can-vote').checked = true;
            
            // Optionally reset motion type to default or first one
            document.getElementById('motion-type-select').value = "Open unmoderated caucus";
            
            // Clear added motions
            document.getElementById('motions-container').innerHTML = '';

            console.log('Form cleared successfully.');
        }

        document.getElementById('add-motion-button').addEventListener('click', () => {
            const motionType = document.getElementById('motion-type-select').value;
            const proposer = document.getElementById('proposer-input').value.trim();
            const duration = document.getElementById('duration-input').value;
            const unit = document.getElementById('duration-unit-select').value;
            const canPropose = document.getElementById('can-propose').checked;
            const canVote = document.getElementById('can-vote').checked;

            if (!motionType) {
                alert('Please select a motion type.');
                return;
            }
            
            if (!proposer) {
                alert('Please enter a proposer name.');
                return;
            }

            // Create Card Element
            const card = document.createElement('div');
            card.className = 'card mb-3 shadow-sm';
            
            card.innerHTML = `
                <div class="card-header bg-light fw-bold">
                    ${motionType}
                </div>
                <div class="card-body">
                    <p class="card-text mb-3">Proposed by: <strong>${proposer}</strong></p>
                    <a href="/speakers" class="btn btn-primary btn-sm">
                        <i class="bi bi-people-fill me-1"></i> Speaker's list
                    </a>
                </div>
            `;
            
            // Append to container
            document.getElementById('motions-container').appendChild(card);
            
            // Scroll to the new card
            card.scrollIntoView({ behavior: 'smooth' });

            // Update Stats
            fetch('/api/stats/update-motion', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `name=${encodeURIComponent(proposer)}&type=${encodeURIComponent(motionType)}`
            }).catch(err => console.error('Error updating motion stats:', err));
        });

        // Initialize the page on load
        document.addEventListener('DOMContentLoaded', () => {
            populateMotionTypeDropdown();
        });

    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>